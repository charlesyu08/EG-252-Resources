<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Dr K. S. (Joseph) Kim">
  <meta name="author" content="Dr Chris P. Jobling">
  <title>=EG-252 Microcontroller Interfacing: Microcontroller Laboratory - Exercise 2: ADC with Keyboard Interrupt</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../../../stylesheets/stylesheet.css">
</head>
<body>

 <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
<h1 class="title">Exercise 2: ADC with Keyboard Interrupt</h1>
<h1 class="subtitle">EG-252 Group Design Exercise â€“ Microcontroller Laboratory</h1>
<h1 class="author">
Dr K. S. (Joseph) Kim
</h1>
<h1 class="author">
Dr Chris P. Jobling
</h1>
<h3 class="date">September 2014</h3>
        </header>
    </div>
<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
<section id="main_content" class="inner">
<h2 id="i.-overview">I. Overview</h2>
<p>For this lab exercise you are provided a sample ADC assembly program given in the appendix. An electronic version of the program is available on the Blackboard site. The program uses interrupt generated by push buttons to trigger an ADC process on the MC9S08AW60 evaluation board. You are to carry out the following two tasks with this exercise:</p>
<ul>
<li>Use the sample program to practice on pushbutton with interrupt mechanism and ADC process with the evaluation board.</li>
<li>Design an equivalent program in C language which can perform the same keyboard interrupt and ADC processing functions as provided by the example assembly program.</li>
</ul>
<p>This exercise is worth 6 marks. For this exercise you need only demonstrate your program with the evaluation board to <em>Dr Chris Jobling by Monday, 8 December 2013</em>. No report is needed.</p>
<p>You can view this document as a web page <a href="exercise2.html">HTML</a>, <a href="exercise2.pdf">PDF</a> or as a Word Document <a href="exercise2.docx">.docx</a></p>
<h1 id="appendix">Appendix</h1>
<h2 id="sample-program-in-assembly">Sample Program in Assembly</h2>
<table class="sourceCode asm numberLines" id="kbi_adc_asm" include="kbi_adc.asm"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td><td class="sourceCode"><pre><code class="sourceCode">;*************************************************************************
;*	kbi_adc.asm                                                          *
;*                                                                       *
;*	MC9S08AW60 Evaluation board keyboard interrupt example               *
;*	- Switch SW3 onboard connected to Port D pin 3, KBI pin6;            *
;*	- Switch SW4 onboard connected to Port D pin 2, KBI pin5             *
;*                                                                       *
;*	Function:                                                            *
;*	On reset all LEDs will light on. If SW3 or SW4 pressed,              *
;*  an interrupt is generated, which set LEDs 0:3 to light on.           *
;*	More interrupts are genereated if SW3 or SW4 are pressed.            *
;*************************************************************************

		INCLUDE	&#39;derivative.inc&#39; ; Include derivative-specific definitions

FLASH	EQU		$2000
RAM		EQU		$0070
WATCH	EQU		$1802

		ORG		RAM
LED_on	DS.B	1		; Define a variable VAR_D with a size of 1 byte

;Start program after reset
		ORG		FLASH
START_UP
		LDA		#$00
		STA		WATCH	; Turn off the watchdog timer
		
;Init_GPIO init code 
		LDA     #$FF
		STA     PTFDD
		MOV     #$0F, LED_on	; Initialize VAR_D, used to control the LEDs
		LDA     #$FF
		STA     PTDPE           ; Port D is enabled with pull-up
		RSP						; Reset stack pointer
                
;Enable interrupt for Keyboard input
		LDA     #$60
		STA     KBI1PE           ; KBI1PE: enable KBI function for pins 5 and 6 only
		BSET    $02, KBI1SC      ; KBI1SC: KBACK=1, to clear KBI flag 
		BSET    $01, KBI1SC      ; KBI1SC: KBIE=1, enable KBI 
                               
		CLI                      ; Enable interrupt

MAINLOOP
		LDA     LED_on           ; Simple loop
		BRA		MAINLOOP

;Interrupt service routine for a keyboard interrupt generated upon the press of a pushbutton
;with a falling edge (transition from high logic level &quot;1&quot; to low logic level &quot;0&quot;)                
LED_SWITCH
		BSET    $02, KBI1SC     ; Clear KBI flag 
		LDA     #8
		STA     ADC1SC1         ; ADC conversion will start after a number is written to ADC1SC1 register.
ADCLOOP                
		TST     ADC1SC1         ; Check the COCO bit (conversion complete flag).
		BPL     ADCLOOP         ; if not complete, wait in the ADC loop.
		LDA     ADC1RL          ; if complete, read the ADC outcome (digital value) from the register.
		STA     PTFD            ; display over LED bar
		RTI                

;INT_VECTOR		
		ORG     $FFD2
		DC.W    LED_SWITCH
		
		ORG     $FFFE
		DC.W    START_UP</code></pre></td></tr></table>
<p>View on <a href="https://github.com/cpjobling/EG-252-Resources/blob/master/Microcontroller-Interfacing/Exercises/Exercise2/kbi_adc.asm">GitHub</a></p>

<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">EG-252 Resources</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.swan.ac.uk" property="cc:attributionName" rel="cc:attributionURL">Swansea University</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.

</div>
</section>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">EG-252-Resources maintained by <a href="https://github.com/cpjobling">cpjobling</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

</body>
</html>
